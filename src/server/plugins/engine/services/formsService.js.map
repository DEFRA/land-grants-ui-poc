{"version":3,"file":"formsService.js","names":["formMetadataSchema","config","FormStatus","getJson","getFormMetadata","slug","getJsonByType","payload","metadata","get","result","validate","error","value","getFormDefinition","id","state","suffix","Draft","definition"],"sources":["../../../../../src/server/plugins/engine/services/formsService.js"],"sourcesContent":["import { formMetadataSchema } from '@defra/forms-model'\n\nimport { config } from '~/src/config/index.js'\nimport { FormStatus } from '~/src/server/routes/types.js'\nimport { getJson } from '~/src/server/services/httpService.js'\n\n/**\n * Retrieves a form definition from the form manager for a given slug\n * @param {string} slug - the slug of the form\n */\nexport async function getFormMetadata(slug) {\n  const getJsonByType = /** @type {typeof getJson<FormMetadata>} */ (getJson)\n\n  const { payload: metadata } = await getJsonByType(\n    `${config.get('managerUrl')}/forms/slug/${slug}`\n  )\n\n  // Run it through the schema to coerce dates\n  const result = formMetadataSchema.validate(metadata)\n\n  if (result.error) {\n    throw result.error\n  }\n\n  return result.value\n}\n\n/**\n * Retrieves a form definition from the form manager for a given id\n * @param {string} id - the id of the form\n * @param {FormStatus} state - the state of the form\n */\nexport async function getFormDefinition(id, state) {\n  const getJsonByType = /** @type {typeof getJson<FormDefinition>} */ (getJson)\n\n  const suffix = state === FormStatus.Draft ? `/${state}` : ''\n  const { payload: definition } = await getJsonByType(\n    `${config.get('managerUrl')}/forms/${id}/definition${suffix}`\n  )\n\n  return definition\n}\n\n/**\n * @import { FormDefinition, FormMetadata } from '@defra/forms-model'\n */\n"],"mappings":"AAAA,SAASA,kBAAkB,QAAQ,oBAAoB;AAEvD,SAASC,MAAM;AACf,SAASC,UAAU;AACnB,SAASC,OAAO;;AAEhB;AACA;AACA;AACA;AACA,OAAO,eAAeC,eAAeA,CAACC,IAAI,EAAE;EAC1C,MAAMC,aAAa,GAAG,2CAA6CH,OAAQ;EAE3E,MAAM;IAAEI,OAAO,EAAEC;EAAS,CAAC,GAAG,MAAMF,aAAa,CAC/C,GAAGL,MAAM,CAACQ,GAAG,CAAC,YAAY,CAAC,eAAeJ,IAAI,EAChD,CAAC;;EAED;EACA,MAAMK,MAAM,GAAGV,kBAAkB,CAACW,QAAQ,CAACH,QAAQ,CAAC;EAEpD,IAAIE,MAAM,CAACE,KAAK,EAAE;IAChB,MAAMF,MAAM,CAACE,KAAK;EACpB;EAEA,OAAOF,MAAM,CAACG,KAAK;AACrB;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,eAAeC,iBAAiBA,CAACC,EAAE,EAAEC,KAAK,EAAE;EACjD,MAAMV,aAAa,GAAG,6CAA+CH,OAAQ;EAE7E,MAAMc,MAAM,GAAGD,KAAK,KAAKd,UAAU,CAACgB,KAAK,GAAG,IAAIF,KAAK,EAAE,GAAG,EAAE;EAC5D,MAAM;IAAET,OAAO,EAAEY;EAAW,CAAC,GAAG,MAAMb,aAAa,CACjD,GAAGL,MAAM,CAACQ,GAAG,CAAC,YAAY,CAAC,UAAUM,EAAE,cAAcE,MAAM,EAC7D,CAAC;EAED,OAAOE,UAAU;AACnB;;AAEA;AACA;AACA","ignoreList":[]}