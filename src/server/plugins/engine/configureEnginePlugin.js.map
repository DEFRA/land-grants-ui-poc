{"version":3,"file":"configureEnginePlugin.js","names":["join","parse","FormModel","plugin","configureEnginePlugin","formFileName","formFilePath","services","model","definition","getForm","name","basePath","options","importPath","ext","attributes","type","formImport","with","default"],"sources":["../../../../src/server/plugins/engine/configureEnginePlugin.ts"],"sourcesContent":["import { join, parse } from 'node:path'\n\nimport { type FormDefinition } from '@defra/forms-model'\nimport { type ServerRegisterPluginObject } from '@hapi/hapi'\n\nimport { FormModel } from '~/src/server/plugins/engine/models/FormModel.js'\nimport {\n  plugin,\n  type PluginOptions\n} from '~/src/server/plugins/engine/plugin.js'\nimport { type RouteConfig } from '~/src/server/types.js'\n\nexport const configureEnginePlugin = async ({\n  formFileName,\n  formFilePath,\n  services\n}: RouteConfig = {}): Promise<ServerRegisterPluginObject<PluginOptions>> => {\n  let model: FormModel | undefined\n\n  if (formFileName && formFilePath) {\n    const definition = await getForm(join(formFilePath, formFileName))\n    const { name } = parse(formFileName)\n\n    model = new FormModel(definition, { basePath: name }, services)\n  }\n\n  return {\n    plugin,\n    options: { model, services }\n  }\n}\n\nexport async function getForm(importPath: string) {\n  const { ext } = parse(importPath)\n\n  const attributes: ImportAttributes = {\n    type: ext === '.json' ? 'json' : 'module'\n  }\n\n  const formImport = import(importPath, { with: attributes }) as Promise<{\n    default: FormDefinition\n  }>\n\n  const { default: definition } = await formImport\n  return definition\n}\n"],"mappings":"AAAA,SAASA,IAAI,EAAEC,KAAK,QAAQ,WAAW;AAKvC,SAASC,SAAS;AAClB,SACEC,MAAM;AAKR,OAAO,MAAMC,qBAAqB,GAAG,MAAAA,CAAO;EAC1CC,YAAY;EACZC,YAAY;EACZC;AACW,CAAC,GAAG,CAAC,CAAC,KAAyD;EAC1E,IAAIC,KAA4B;EAEhC,IAAIH,YAAY,IAAIC,YAAY,EAAE;IAChC,MAAMG,UAAU,GAAG,MAAMC,OAAO,CAACV,IAAI,CAACM,YAAY,EAAED,YAAY,CAAC,CAAC;IAClE,MAAM;MAAEM;IAAK,CAAC,GAAGV,KAAK,CAACI,YAAY,CAAC;IAEpCG,KAAK,GAAG,IAAIN,SAAS,CAACO,UAAU,EAAE;MAAEG,QAAQ,EAAED;IAAK,CAAC,EAAEJ,QAAQ,CAAC;EACjE;EAEA,OAAO;IACLJ,MAAM;IACNU,OAAO,EAAE;MAAEL,KAAK;MAAED;IAAS;EAC7B,CAAC;AACH,CAAC;AAED,OAAO,eAAeG,OAAOA,CAACI,UAAkB,EAAE;EAChD,MAAM;IAAEC;EAAI,CAAC,GAAGd,KAAK,CAACa,UAAU,CAAC;EAEjC,MAAME,UAA4B,GAAG;IACnCC,IAAI,EAAEF,GAAG,KAAK,OAAO,GAAG,MAAM,GAAG;EACnC,CAAC;EAED,MAAMG,UAAU,GAAG,MAAM,CAACJ,UAAU,EAAE;IAAEK,IAAI,EAAEH;EAAW,CAAC,CAExD;EAEF,MAAM;IAAEI,OAAO,EAAEX;EAAW,CAAC,GAAG,MAAMS,UAAU;EAChD,OAAOT,UAAU;AACnB","ignoreList":[]}