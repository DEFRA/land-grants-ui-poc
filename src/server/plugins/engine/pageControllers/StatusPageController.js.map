{"version":3,"file":"StatusPageController.js","names":["QuestionPageController","StatusPageController","constructor","model","pageDef","viewName","getRelevantPath","getStatusPath","makeGetRouteHandler","request","context","h","viewModel","cacheService","services","confirmationState","getConfirmationState","confirmed","proceed","getStartPath","slug","params","formsService","getFormMetadata","submissionGuidance","view"],"sources":["../../../../../src/server/plugins/engine/pageControllers/StatusPageController.ts"],"sourcesContent":["import { type PageStatus } from '@defra/forms-model'\nimport { type ResponseToolkit } from '@hapi/hapi'\n\nimport { type FormModel } from '~/src/server/plugins/engine/models/index.js'\nimport { QuestionPageController } from '~/src/server/plugins/engine/pageControllers/QuestionPageController.js'\nimport { type FormContext } from '~/src/server/plugins/engine/types.js'\nimport { type FormRequest } from '~/src/server/routes/types.js'\n\nexport class StatusPageController extends QuestionPageController {\n  declare pageDef: PageStatus\n\n  constructor(model: FormModel, pageDef: PageStatus) {\n    super(model, pageDef)\n    this.viewName = 'confirmation'\n  }\n\n  getRelevantPath() {\n    return this.getStatusPath()\n  }\n\n  makeGetRouteHandler() {\n    return async (\n      request: FormRequest,\n      context: FormContext,\n      h: Pick<ResponseToolkit, 'redirect' | 'view'>\n    ) => {\n      const { viewModel, viewName } = this\n\n      const { cacheService } = request.services([])\n      const confirmationState = await cacheService.getConfirmationState(request)\n\n      // If there's no confirmation state, then\n      // redirect the user back to the start of the form\n      if (!confirmationState.confirmed) {\n        return this.proceed(request, h, this.getStartPath())\n      }\n\n      const slug = request.params.slug\n      const { formsService } = this.model.services\n      const { getFormMetadata } = formsService\n\n      const { submissionGuidance } = await getFormMetadata(slug)\n\n      return h.view(viewName, {\n        ...viewModel,\n        submissionGuidance\n      })\n    }\n  }\n}\n"],"mappings":"AAIA,SAASA,sBAAsB;AAI/B,OAAO,MAAMC,oBAAoB,SAASD,sBAAsB,CAAC;EAG/DE,WAAWA,CAACC,KAAgB,EAAEC,OAAmB,EAAE;IACjD,KAAK,CAACD,KAAK,EAAEC,OAAO,CAAC;IACrB,IAAI,CAACC,QAAQ,GAAG,cAAc;EAChC;EAEAC,eAAeA,CAAA,EAAG;IAChB,OAAO,IAAI,CAACC,aAAa,CAAC,CAAC;EAC7B;EAEAC,mBAAmBA,CAAA,EAAG;IACpB,OAAO,OACLC,OAAoB,EACpBC,OAAoB,EACpBC,CAA6C,KAC1C;MACH,MAAM;QAAEC,SAAS;QAAEP;MAAS,CAAC,GAAG,IAAI;MAEpC,MAAM;QAAEQ;MAAa,CAAC,GAAGJ,OAAO,CAACK,QAAQ,CAAC,EAAE,CAAC;MAC7C,MAAMC,iBAAiB,GAAG,MAAMF,YAAY,CAACG,oBAAoB,CAACP,OAAO,CAAC;;MAE1E;MACA;MACA,IAAI,CAACM,iBAAiB,CAACE,SAAS,EAAE;QAChC,OAAO,IAAI,CAACC,OAAO,CAACT,OAAO,EAAEE,CAAC,EAAE,IAAI,CAACQ,YAAY,CAAC,CAAC,CAAC;MACtD;MAEA,MAAMC,IAAI,GAAGX,OAAO,CAACY,MAAM,CAACD,IAAI;MAChC,MAAM;QAAEE;MAAa,CAAC,GAAG,IAAI,CAACnB,KAAK,CAACW,QAAQ;MAC5C,MAAM;QAAES;MAAgB,CAAC,GAAGD,YAAY;MAExC,MAAM;QAAEE;MAAmB,CAAC,GAAG,MAAMD,eAAe,CAACH,IAAI,CAAC;MAE1D,OAAOT,CAAC,CAACc,IAAI,CAACpB,QAAQ,EAAE;QACtB,GAAGO,SAAS;QACZY;MACF,CAAC,CAAC;IACJ,CAAC;EACH;AACF","ignoreList":[]}