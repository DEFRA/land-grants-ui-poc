{"version":3,"file":"TextField.js","names":["joi","FormComponent","isFormValue","TextField","constructor","def","props","options","title","schema","formSchema","string","trim","label","toLowerCase","required","allow","length","max","min","regex","pattern","RegExp","customValidationMessage","message","messages","customValidationMessages","default","stateSchema","getFormValueFromState","state","name","getFormValue","value","isValue","undefined","isText"],"sources":["../../../../../src/server/plugins/engine/components/TextField.ts"],"sourcesContent":["import {\n  type EmailAddressFieldComponent,\n  type TextFieldComponent\n} from '@defra/forms-model'\nimport joi, { type StringSchema } from 'joi'\n\nimport {\n  FormComponent,\n  isFormValue\n} from '~/src/server/plugins/engine/components/FormComponent.js'\nimport {\n  type FormState,\n  type FormStateValue,\n  type FormSubmissionState\n} from '~/src/server/plugins/engine/types.js'\n\nexport class TextField extends FormComponent {\n  declare options:\n    | TextFieldComponent['options']\n    | EmailAddressFieldComponent['options']\n\n  declare schema: TextFieldComponent['schema']\n\n  declare formSchema: StringSchema\n  declare stateSchema: StringSchema\n\n  constructor(\n    def: TextFieldComponent | EmailAddressFieldComponent,\n    props: ConstructorParameters<typeof FormComponent>[1]\n  ) {\n    super(def, props)\n\n    const { options, title } = def\n    const schema = 'schema' in def ? def.schema : {}\n\n    let formSchema = joi.string().trim().label(title.toLowerCase()).required()\n\n    if (options.required === false) {\n      formSchema = formSchema.allow('')\n    }\n\n    if (typeof schema.length !== 'number') {\n      if (typeof schema.max === 'number') {\n        formSchema = formSchema.max(schema.max)\n      }\n\n      if (typeof schema.min === 'number') {\n        formSchema = formSchema.min(schema.min)\n      }\n    } else {\n      formSchema = formSchema.length(schema.length)\n    }\n\n    if (schema.regex) {\n      const pattern = new RegExp(schema.regex)\n      formSchema = formSchema.pattern(pattern)\n    }\n\n    if (options.customValidationMessage) {\n      const message = options.customValidationMessage\n\n      formSchema = formSchema.messages({\n        'any.required': message,\n        'string.empty': message,\n        'string.max': message,\n        'string.min': message,\n        'string.length': message,\n        'string.pattern.base': message\n      })\n    } else if (options.customValidationMessages) {\n      formSchema = formSchema.messages(options.customValidationMessages)\n    }\n\n    this.formSchema = formSchema.default('')\n    this.stateSchema = formSchema.default(null).allow(null)\n    this.options = options\n    this.schema = schema\n  }\n\n  getFormValueFromState(state: FormSubmissionState) {\n    const { name } = this\n    return this.getFormValue(state[name])\n  }\n\n  getFormValue(value?: FormStateValue | FormState) {\n    return this.isValue(value) ? value : undefined\n  }\n\n  isValue(value?: FormStateValue | FormState): value is string {\n    return TextField.isText(value)\n  }\n\n  static isText(value?: FormStateValue | FormState): value is string {\n    return isFormValue(value) && typeof value === 'string'\n  }\n}\n"],"mappings":"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","ignoreList":[]}